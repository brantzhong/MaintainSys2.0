"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));!function(e){"object"===("undefined"==typeof exports?"undefined":(0,_typeof2.default)(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):window.imageConversion=e()}(function(){var e={};function t(e){return["image/png","image/jpeg","image/gif"].some(function(t){return t===e})}return e.urltoImage=function(e){return new Promise(function(t,r){var a=new Image;a.onload=function(){return t(a)},a.onerror=function(){return r(new Error("urltoImage(): Image failed to load, please check the image URL"))},a.src=e})},e.urltoBlob=function(e){return fetch(e).then(function(e){return e.blob()})},e.imagetoCanvas=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,a,n,u,i,o,c,s=arguments;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in r=s.length>1&&void 0!==s[1]?s[1]:{},a=document.createElement("canvas"),n=a.getContext("2d"),r)Object.prototype.hasOwnProperty.call(r,o)&&(r[o]=Number(r[o]));r.scale?(c=r.scale>0&&r.scale<10?r.scale:1,i=t.width*c,u=t.height*c):(i=r.width||r.height*t.width/t.height||t.width,u=r.height||r.width*t.height/t.width||t.height),[5,6,7,8].some(function(e){return e===r.orientation})?(a.height=i,a.width=u):(a.height=u,a.width=i),e.t0=r.orientation,e.next=3===e.t0?9:6===e.t0?12:8===e.t0?15:2===e.t0?18:4===e.t0?22:5===e.t0?27:7===e.t0?32:37;break;case 9:return n.rotate(180*Math.PI/180),n.drawImage(t,-a.width,-a.height,a.width,a.height),e.abrupt("break",38);case 12:return n.rotate(90*Math.PI/180),n.drawImage(t,0,-a.width,a.height,a.width),e.abrupt("break",38);case 15:return n.rotate(270*Math.PI/180),n.drawImage(t,-a.height,0,a.height,a.width),e.abrupt("break",38);case 18:return n.translate(a.width,0),n.scale(-1,1),n.drawImage(t,0,0,a.width,a.height),e.abrupt("break",38);case 22:return n.translate(a.width,0),n.scale(-1,1),n.rotate(180*Math.PI/180),n.drawImage(t,-a.width,-a.height,a.width,a.height),e.abrupt("break",38);case 27:return n.translate(a.width,0),n.scale(-1,1),n.rotate(90*Math.PI/180),n.drawImage(t,0,-a.width,a.height,a.width),e.abrupt("break",38);case 32:return n.translate(a.width,0),n.scale(-1,1),n.rotate(270*Math.PI/180),n.drawImage(t,-a.height,0,a.height,a.width),e.abrupt("break",38);case 37:n.drawImage(t,0,0,a.width,a.height);case 38:return e.abrupt("return",a);case 39:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.canvastoFile=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/jpeg";return new Promise(function(a){return e.toBlob(function(e){return a(e)},r,t)})},e.canvastoDataURL=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,a,n){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t(n)||(n="image/jpeg"),e.abrupt("return",r.toDataURL(n,a));case 2:case"end":return e.stop()}},e)}));return function(t,r,a){return e.apply(this,arguments)}}(),e.filetoDataURL=function(e){return new Promise(function(t){var r=new FileReader;r.onloadend=function(e){return t(e.target.result)},r.readAsDataURL(e)})},e.dataURLtoImage=function(e){return new Promise(function(t,r){var a=new Image;a.onload=function(){return t(a)},a.onerror=function(){return r(new Error("dataURLtoImage(): dataURL is illegal"))},a.src=e})},e.dataURLtoFile=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,a){var n,u,i,o,c;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=r.split(","),u=n[0].match(/:(.*?);/)[1],i=atob(n[1]),o=i.length,c=new Uint8Array(o);o--;)c[o]=i.charCodeAt(o);return t(a)&&(u=a),e.abrupt("return",new Blob([c],{type:u}));case 8:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),e.downloadFile=function(e,t){var r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t||Date.now().toString(36),document.body.appendChild(r);var a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),r.dispatchEvent(a),document.body.removeChild(r)},e.compress=function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function r(a){var n,u,i,o,c,s,l,h,f=arguments;return _regenerator.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:{},a instanceof Blob){r.next=3;break}throw new Error("compress(): First arg must be a Blob object or a File object.");case 3:if("object"!==(0,_typeof2.default)(n)&&(n=Object.assign({quality:n})),n.quality=Number(n.quality),!Number.isNaN(n.quality)){r.next=7;break}return r.abrupt("return",a);case 7:return r.next=9,e.filetoDataURL(a);case 9:return u=r.sent,i=u.split(",")[0].match(/:(.*?);/)[1],o="image/jpeg",t(n.type)&&(o=n.type,i=n.type),r.next=15,e.dataURLtoImage(u);case 15:return c=r.sent,r.next=18,e.imagetoCanvas(c,Object.assign({},n));case 18:return s=r.sent,r.next=21,e.canvastoDataURL(s,n.quality,o);case 21:return l=r.sent,r.next=24,e.dataURLtoFile(l,i);case 24:return h=r.sent,r.abrupt("return",h);case 26:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}(),e.compressAccurately=function(){var r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function r(a){var n,u,i,o,c,s,l,h,f,d,p,g,b,m,w=arguments;return _regenerator.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=w.length>1&&void 0!==w[1]?w[1]:{},a instanceof Blob){r.next=3;break}throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");case 3:if("object"!==(0,_typeof2.default)(n)&&(n=Object.assign({size:n})),n.size=Number(n.size),!Number.isNaN(n.size)){r.next=7;break}return r.abrupt("return",a);case 7:if(!(1024*n.size>a.size)){r.next=9;break}return r.abrupt("return",a);case 9:return n.accuracy=Number(n.accuracy),(!n.accuracy||n.accuracy<.8||n.accuracy>.99)&&(n.accuracy=.95),u={max:n.size*(2-n.accuracy)*1024,accurate:1024*n.size,min:n.size*n.accuracy*1024},r.next=14,e.filetoDataURL(a);case 14:return i=r.sent,o=i.split(",")[0].match(/:(.*?);/)[1],c="image/jpeg",t(n.type)&&(c=n.type,o=n.type),r.next=20,e.dataURLtoImage(i);case 20:return s=r.sent,r.next=23,e.imagetoCanvas(s,Object.assign({},n));case 23:l=r.sent,h=.75,f=.5,p=[null,null],g=1;case 28:if(!(g<=7)){r.next=50;break}return r.next=31,e.canvastoDataURL(l,f,c);case 31:if(d=r.sent,b=d.length*h,7!==g){r.next=36;break}return(u.max<b||u.min>b)&&(d=[d].concat(p).filter(function(e){return e}).sort(function(e,t){return Math.abs(e.length*h-u.accurate)-Math.abs(t.length*h-u.accurate)})[0]),r.abrupt("break",50);case 36:if(!(u.max<b)){r.next=41;break}p[1]=d,f-=Math.pow(.5,g+1),r.next=47;break;case 41:if(!(u.min>b)){r.next=46;break}p[0]=d,f+=Math.pow(.5,g+1),r.next=47;break;case 46:return r.abrupt("break",50);case 47:g++,r.next=28;break;case 50:return r.next=52,e.dataURLtoFile(d,o);case 52:if(!((m=r.sent).size>a.size)){r.next=55;break}return r.abrupt("return",a);case 55:return r.abrupt("return",m);case 56:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}(),e});